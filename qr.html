<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>롯데마트 M쿠폰 Lacuncer | QR</title>
    <link rel="stylesheet" type="text/css" href="https://imagecoupon.lottemart.com/lmscp/app/resources/v4/css/reset.css">
    <style>
        body{            
            background-color: #ebebeb;
        }
        button{
            display: block;
        }
        .div-buttons{
            background-color: #fce246;
            padding-top: 22px;
            padding-bottom: 17px;
        }
        button:not(:first-child){
            margin-top: 7px;
        }
        img{
            width: 100%; height: auto;
        }
    </style>
</head>
<body>
    
    <div>
        <div class="div-buttons">
            <button type="button" onclick="goStore()"><img src="https://imagecoupon.lottemart.com/lmscp/app/resources/v4/image/launcher/launcher-button1.gif" alt="M쿠폰 앱 다운받기"></button>
            <button type="button" onclick="runApp()"><img src="https://imagecoupon.lottemart.com/lmscp/app/resources/v4/image/launcher/launcher-button2.gif" alt="M쿠폰 앱 실행하기"></button>    
        </div>
        <div><img src="https://imagecoupon.lottemart.com/lmscp/app/resources/v4/image/launcher/launcher-img1.gif"></div>
        <div><img src="https://imagecoupon.lottemart.com/lmscp/app/resources/v4/image/launcher/launcher-img2.gif"></div>
    </div>

<script>

// 목록 구소스 : http://m.coupond.lottemart.com/launcher/qr.html?_route=application/receipt/receiptMainLN.html?_from=Q_amp_utm_source=owned_amp_utm_medium=qrcode_amp_utm_campaign=share

// 목록 신소스 : http://m.coupond.lottemart.com/launcher/qr.html?_route=/v2/cpbooklist?_from=Q_amp_utm_source=owned_amp_utm_medium=qrcode_amp_utm_campaign=share

// 상세 신소스 : http://m.coupond.lottemart.com/launcher/qr.html?_route=/coupon?_from=Q_amp_issue_coupon_no_digit=401%2105q1111Ahac00p%400_amp_utm_source=owned_amp_utm_medium=qrcode_amp_utm_campaign=share


var userAgent = navigator.userAgent || navigator.vendor || window.opera;
var isIOS = /iPhone/i.test(userAgent);

var host = location.href.split('/launcher/')[0],
    url = location.href.split('?_route=')[1],
    isOldPage = false;

if(url.indexOf('application/')>-1){
    // 구소스
    url = host + url;
    isOldPage = true;
    //url = 'http://m.coupond.lottemart.com/application/receipt/receiptMainLN.html';
} else{
    // 신소스
    var path = '/application/main/main.html?_route=';
    url = host + path + url;
}
console.log('url', url);

var launchAndroid = function(){
    var browser = userAgent.toLowerCase();
        if ( parseFloat(browser.substr(browser.indexOf("android")+8, 3)) >= 4.4 ) {
        location.href = "intent://m.coupon.lottemart?url="+url+"#Intent;scheme=lmscp;action=android.intent.action.VIEW;category=android.intent.category.BROWSABLE;package=com.lottemart.lmscp;end";
        } else {
            location.href = "lmscp://m.coupon.lottemart?url=" + url;
            setTimeout(function(){ 
                location.href="market://details?id=com.lottemart.lmscp"; 
            }, 300 );
        }
};

var goStore = function(){
    if(isIOS){
        location.href = "https://itunes.apple.com/app/id987435592";
    } else{
        location.href="market://details?id=com.lottemart.lmscp"; 
    }
};

var runApp = function(){
    if(isOldPage){
        var req = new XMLHttpRequest();
        req.open('GET', 'http://m.coupond.lottemart.com/apis/hybridapp/renew/common/connection/log', true);
        req.onreadystatechange = function(aEvt){
            if (req.readyState == 4) {
                if(req.status == 200) {

                } else {
                    console.log("There was a problem with the request.");
                }
            }
        };
        req.send({"conn_gbn=Q"});
    }
    if(isIOS ){
        location.href = userAgent.indexOf("mcoupon") > -1 ? url : "lottemart-mcoupon-iphone://?url=" + url;  
    } else{
        window.launchAndroid();
    }
};

// load시 실행
window.runApp(); 

</script>
</body>
</html>
